<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MAJEED & SONS | GENERAL ORDER SUPPLIERS</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Poppins}
body{margin:0;background:#f1f5f9}
.page{display:none;padding:15px}
.page.active{display:block}
.card{background:#fff;padding:15px;border-radius:15px;margin-bottom:15px}
button{padding:10px;border-radius:12px;border:none}
.primary{background:#facc15;font-weight:700}
.warn{background:#000;color:#fff}
.danger{background:#dc2626;color:#fff}
nav{display:flex;gap:6px;justify-content:center;background:#fff;padding:10px}
nav button.active{background:#facc15}
table{width:100%;border-collapse:collapse;font-size:13px}
td,th{padding:6px;border-bottom:1px solid #eee;text-align:center}

#loginBox{
position:fixed;inset:0;
background:#000;color:#fff;
display:flex;flex-direction:column;
align-items:center;justify-content:center;
z-index:9999
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
<h2>MAJEED & SONS</h2>
<input id="passwordInput" type="password" placeholder="Password">
<button onclick="doLogin()">LOGIN</button>
</div>

<header style="background:#000;color:#facc15;text-align:center;padding:15px">
<h2>MAJEED & SONS</h2>
</header>

<nav>
<button class="active" onclick="openPage('dashboard',this)">Dashboard</button>
<button onclick="openPage('products',this)">Products</button>
<button onclick="openPage('sales',this)">Sales</button>
<button onclick="openPage('history',this)">Bills</button>
</nav>

<!-- DASHBOARD -->
<div id="dashboard" class="page active">
<div class="card">
<h3>Total Products: <span id="dProducts">0</span></h3>
<h3>Total Bills: <span id="dBills">0</span></h3>
<h3>Total Sales: <span id="dSales">0</span></h3>
</div>
</div>

<!-- PRODUCTS -->
<div id="products" class="page">
<div class="card">
<input id="pname" placeholder="Product Name">
<input id="psale" placeholder="Price">
<button class="primary" onclick="addProduct()">Save</button>
<table>
<thead><tr><th>Name</th><th>Price</th><th>‚ùå</th></tr></thead>
<tbody id="plist"></tbody>
</table>
</div>
</div>

<!-- SALES -->
<div id="sales" class="page">
<div class="card">
<input id="cname" placeholder="Customer Name">
<input id="sname" placeholder="Product">
<input id="sprice" placeholder="Price">
<input id="sqty" placeholder="Qty">
<button class="primary" onclick="addSale()">Add</button>

<table>
<thead><tr><th>Item</th><th>Qty</th><th>Total</th></tr></thead>
<tbody id="slist"></tbody>
</table>

<b>Total: <span id="stotal">0</span></b><br><br>
<button class="primary" onclick="saveBill()">Save Bill</button>
</div>
</div>

<!-- HISTORY -->
<div id="history" class="page">
<div id="historyBox"></div>
</div>

<!-- üî• FIREBASE (NO MODULE ERROR) -->
<script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCDyeC1YMqFEm6b3eYYpV30eL-OkUilhwI",
  authDomain: "majeedsonsdatabase.firebaseapp.com",
  projectId: "majeedsonsdatabase",
  storageBucket: "majeedsonsdatabase.appspot.com",
  messagingSenderId: "810169181128",
  appId: "1:810169181128:web:74f54e335be0f59db416fd"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
/* ===== APP LOGIC ===== */
const LOGIN_PASSWORD="786";
let products=[];
let cart=[];
let history=[];

function doLogin(){
  if(passwordInput.value===LOGIN_PASSWORD){
    loginBox.style.display="none";
  }
}

function openPage(id,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}

/* PRODUCTS */
function addProduct(){
  products.push({n:pname.value,p:psale.value});
  renderProducts();
  updateDashboard();
}
function renderProducts(){
  plist.innerHTML="";
  products.forEach((p,i)=>{
    plist.innerHTML+=`<tr>
      <td>${p.n}</td><td>${p.p}</td>
      <td><button onclick="products.splice(${i},1);renderProducts()">‚ùå</button></td>
    </tr>`;
  });
}

/* SALES */
function addSale(){
  let t=sprice.value*sqty.value;
  cart.push({n:sname.value,q:sqty.value,t});
  renderSales();
}
function renderSales(){
  let sum=0; slist.innerHTML="";
  cart.forEach(i=>{
    sum+=i.t;
    slist.innerHTML+=`<tr><td>${i.n}</td><td>${i.q}</td><td>${i.t}</td></tr>`;
  });
  stotal.innerText=sum;
}

/* SAVE BILL ‚Üí FIREBASE */
function saveBill(){
  let bill={
    customer:cname.value,
    items:cart,
    total:stotal.innerText,
    time:new Date().toLocaleString()
  };

  db.collection("bills").add(bill).then(()=>{
    history.push(bill);
    renderHistory();
    cart=[]; renderSales();
    updateDashboard();
    alert("‚úÖ Bill Saved & Synced");
  });
}

function renderHistory(){
  historyBox.innerHTML="";
  history.forEach(h=>{
    historyBox.innerHTML+=`
    <div class="card">
    <b>${h.customer}</b><br>${h.time}<br>
    Total: ${h.total}
    </div>`;
  });
}

function updateDashboard(){
  dProducts.innerText=products.length;
  dBills.innerText=history.length;
  dSales.innerText=history.reduce((a,b)=>a+Number(b.total),0);
}

/* LOAD FIREBASE DATA */
db.collection("bills").get().then(snap=>{
  snap.forEach(doc=>history.push(doc.data()));
  renderHistory(); updateDashboard();
});
</script>

</body>
</html>
