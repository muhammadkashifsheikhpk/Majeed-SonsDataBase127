<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MAJEED & SONS | GENERAL ORDER SUPPLIERS</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

<style>
* {
  box-sizing: border-box;
  font-family: Poppins;
}
body {
  margin: 0;
  background: #f1f5f9;
}
/* Micro animations & layout styles (same as your code) */
.page {
  display: none;
  padding: 15px;
}
.page.active {
  display: block;
}
button {
  padding: 10px;
  border-radius: 12px;
  border: none;
}
.primary {
  background: #facc15;
  font-weight: 700;
}
.warn {
  background: #000;
  color: #fff;
}
.danger {
  background: #dc2626;
  color: #fff;
}
nav {
  display: flex;
  gap: 6px;
  justify-content: center;
  background: #fff;
  padding: 10px;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}
td, th {
  padding: 6px;
  border-bottom: 1px solid #eee;
  text-align: center;
}

/* Login style */
#loginBox {
  position: fixed; inset: 0;
  background: linear-gradient(135deg, #000, #1f2937);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  z-index: 9999;
}
#loginBox h2 {
  color: #facc15;
}
#loginBox input {
  padding: 14px;
  width: 260px;
  border-radius: 14px;
  border: none;
  text-align: center;
  margin-top: 10px;
}
#loginBox button {
  margin-top: 15px;
  padding: 12px 40px;
  border-radius: 14px;
  background: #facc15;
  font-weight: 700;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
<h2>MAJEED & SONS</h2>
<input id="passwordInput" type="password" placeholder="Password" />
<button onclick="doLogin()">LOGIN</button>
</div>

<header style="background:#000; color:#facc15; text-align:center; padding:15px;">
<h2>MAJEED & SONS</h2>
</header>

<nav>
<button class="active" onclick="openPage('dashboard',this)">Dashboard</button>
<button onclick="openPage('products',this)">Products</button>
<button onclick="openPage('sales',this)">Sales</button>
<button onclick="openPage('bill',this)">Bill</button>
<button onclick="openPage('history',this)">Bills</button>
</nav>

<!-- Dashboard -->
<div id="dashboard" class="page active">
<div class="card">
<h3>Total Products: <span id="dProducts">0</span></h3>
<h3>Total Bills: <span id="dBills">0</span></h3>
<h3>Total Sales: <span id="dSales">0</span></h3>
</div>
</div>

<!-- PRODUCTS -->
<div id="products" class="page">
<div class="card">
<input id="pname" placeholder="Product Name" />
<input id="psale" placeholder="Price" />
<button class="primary" onclick="addProduct()">Save</button>
<table>
<thead><tr><th>Name</th><th>Price</th><th>‚ùå</th></tr></thead>
<tbody id="plist"></tbody>
</table>
</div>
</div>

<!-- SALES -->
<div id="sales" class="page">
<div class="card">
<input id="cname" placeholder="Customer Name" />
<input id="sname" placeholder="Product" />
<input id="sprice" placeholder="Price" />
<input id="sqty" placeholder="Qty" />
<button class="primary" onclick="addSale()">Add</button>
<table>
<thead><tr><th>Item</th><th>Qty</th><th>Total</th></tr></thead>
<tbody id="slist"></tbody>
</table>
<b>Total: <span id="stotal">0</span></b><br><br>
<button class="primary" onclick="saveBill()">Save Bill</button>
</div>
</div>

<!-- BILL -->
<div id="bill" class="page">
<div class="card" id="billCard">
<div style="text-align:center;font-size:12px">
<b>MAJEED & SONS</b><br />
GENERAL ORDER SUPPLIERS (SMC-PVT) LTD<br />
Shop #127, Near Hakeem Shafique<br />
Main RA Bazar, Lahore Cantt<br />
üìû 0328-4161906 | 0301-0429227
<hr />
</div>
<b>Date:</b> <span id="bdate"></span><br />
<b>Customer:</b> <span id="bcustomer"></span></b><br />
<b>Number:</b> <span id="bphone"></span></b>
<table>
<thead><tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th></tr></thead>
<tbody id="bitems"></tbody>
</table>
<h3>Total: <span id="btotal"></span></h3>
<h4>Paid: <span id="bpaid"></span></h4>
<h4>Remaining: <span id="bremain"></span></h4>
<b style="font-size:14px">THANKS FOR SHOPPING!</b>
</div>
<button class="primary no-print" onclick="saveBill()">Save</button>
<button class="warn no-print" onclick="resetBill()">Reset Bill</button>
<button class="primary no-print" onclick="window.print()">Print</button>
</div>

<!-- HISTORY -->
<div id="history" class="page">
<div class="card">
<div class="grid">
<input placeholder="Search Name" oninput="filterHistory()" />
<input type="date" id="hdate" onchange="filterHistory()" />
</div>
<br />
<button class="danger" onclick="clearAllBills()">üóë CLEAR ALL BILLS</button>
</div>
<div id="historyBox"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCDyeC1YMqFEm6b3eYYpV30eL-OkUilhwI",
  authDomain: "majeedsonsdatabase.firebaseapp.com",
  projectId: "majeedsonsdatabase",
  storageBucket: "majeedsonsdatabase.appspot.com",
  messagingSenderId: "810169181128",
  appId: "1:810169181128:web:74f54e335be0f59db416fd"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ===== APP LOGIC ===== */
const LOGIN_PASSWORD="786";
let products=JSON.parse(localStorage.products||"[]");
let cart=[];
let history=[];

function doLogin() {
  if (passwordInput.value === LOGIN_PASSWORD) {
    document.getElementById("loginBox").style.display = "none";
  }
}

function openPage(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

/* PRODUCTS */
function addProduct() {
  products.push({ n: pname.value, p: psale.value });
  localStorage.setItem('products', JSON.stringify(products));
  renderProducts();
  updateDashboard();
}
function renderProducts() {
  document.getElementById("plist").innerHTML = "";
  products.forEach((p, i) => {
    document.getElementById("plist").innerHTML += `
      <tr>
        <td>${p.n}</td>
        <td>${p.p}</td>
        <td><button class="danger" onclick="products.splice(${i},1);localStorage.setItem('products', JSON.stringify(products));renderProducts();updateDashboard()">‚ùå</button></td>
      </tr>`;
  });
}

/* SALES */
function addSale() {
  let total = Number(sprice.value) * Number(sqty.value);
  cart.push({ n: sname.value, q: sqty.value, t: total });
  renderSales();
}
function renderSales() {
  let sum = 0;
  document.getElementById("slist").innerHTML = "";
  cart.forEach((i, x) => {
    sum += i.t;
    document.getElementById("slist").innerHTML += `
      <tr>
        <td>${i.n}</td>
        <td>${i.q}</td>
        <td>${i.t}</td>
        <td><button onclick="cart.splice(${x},1);renderSales()">‚ùå</button></td>
      </tr>`;
  });
  document.getElementById("stotal").innerText = sum;
  calcRemain();
}
function calcRemain() {
  document.getElementById("remain").innerText = Number(document.getElementById("stotal").innerText) - (Number(document.getElementById("paid").value) || 0);
}

/* SAVE BILL - with Firebase */
function generateBill() {
  document.getElementById("bdate").innerText = new Date().toLocaleString();
  document.getElementById("bcustomer").innerText = document.getElementById("cname").value;
  document.getElementById("bphone").innerText = document.getElementById("cphone").value || "-";
  let bitems = document.getElementById("bitems");
  bitems.innerHTML = "";
  cart.forEach(i => bitems.innerHTML += `
    <tr>
      <td>${i.n}</td>
      <td>${i.q}</td>
      <td>${i.p}</td>
      <td>${i.t}</td>
    </tr>`);
  document.getElementById("btotal").innerText = document.getElementById("stotal").innerText;
  document.getElementById("bpaid").innerText = document.getElementById("paid").value || 0;
  document.getElementById("bremain").innerText = document.getElementById("remain").innerText;
  // Save to Firebase
  saveBillToFirebase({
    date: new Date().toISOString(),
    customer: document.getElementById("bcustomer").innerText,
    phone: document.getElementById("bphone").innerText,
    items: [...cart],
    total: document.getElementById("stotal").innerText,
    paid: document.getElementById("paid").value,
    remain: document.getElementById("remain").innerText
  });
  // Switch to bill page
  let bill = document.getElementById("billCard");
  bill.classList.remove("bill-animate");
  setTimeout(() => bill.classList.add("bill-animate"), 10);
  goto('bill');
}

/* Save bill to Firebase */
function saveBillToFirebase(billData) {
  firebase.firestore().collection("bills").add(billData)
    .then(() => {
      // Update local history
      history.push(billData);
      localStorage.setItem('history', JSON.stringify(history));
      renderHistory();
      alert("‚úÖ Bill saved & synced with Firebase");
    })
    .catch((err) => {
      console.error("Error saving bill to Firebase:", err);
    });
}

/* Reset */
function resetBill() {
  cart = [];
  renderSales();
  document.getElementById("cname").value = "";
  document.getElementById("cphone").value = "";
  document.getElementById("paid").value = "";
  goto('sales');
}

/* HISTORY */
function saveBill() {
  let d = new Date();
  const bill = {
    name: document.getElementById("cname").value,
    phone: document.getElementById("cphone").value,
    date: d.toISOString().slice(0, 10),
    time: d.toLocaleString(),
    items: [...cart],
    total: document.getElementById("stotal").innerText
  };
  // Save locally
  history.push(bill);
  localStorage.setItem('history', JSON.stringify(history));
  // Save to Firebase
  saveBillToFirebase(bill);
  resetBill();
  renderHistory();
  updateDashboard();
}

/* Render history from local storage & Firebase data */
function renderHistory() {
  document.getElementById("historyBox").innerHTML = "";
  // show local history
  history.forEach(h => {
    document.getElementById("historyBox").innerHTML += `
    <div class="card">
      <b>${h.time}</b><br>${h.name} ${h.phone || ""}<br>
      Total: ${h.total}
    </div>`;
  });
  // Fetch and merge Firebase bills (optional: you can also replace local with Firebase only)
  // For now, assuming local is primary
}

/* Fetch existing bills from Firebase on load */
firebase.firestore().collection("bills").get().then(snap => {
  snap.forEach(doc => {
    const data = doc.data();
    // Optional: merge with local 'history' array if needed
    // For now, just show in UI
    // You may want to update local 'history' array if needed
  });
  // You can call renderHistory() here if you want to show Firebase data
});

// Additional functions
function filterHistory() {
  // Your filtering code if needed
}
function clearAllBills() {
  if (confirm("Delete ALL bills?")) {
    // Delete all bills in Firebase
    firebase.firestore().collection("bills").get().then(snap => {
      snap.forEach(doc => doc.ref.delete());
    });
    // Clear local
    localStorage.removeItem('history');
    history = [];
    renderHistory();
  }
}
function clearAllData() {
  if (confirm("DELETE ALL DATA?")) {
    localStorage.clear();
    products = [];
    history = [];
    cart = [];
    renderProducts(); renderHistory(); updateDashboard();
  }
}
function updateDashboard() {
  document.getElementById("dProducts").innerText = products.length;
  document.getElementById("dBills").innerText = history.length;
  // Sum total sales from history
  let totalSales = history.reduce((a, h) => a + Number(h.total || 0), 0);
  document.getElementById("dSales").innerText = totalSales;
}

// Load products from local storage initially
renderProducts();
updateDashboard();
</script>

<script>
// Helper functions for page navigation
function goto(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(page).classList.add('active');
}
function openPage(id, btn) {
  goto(id);
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// Login
function doLogin() {
  if (document.getElementById('passwordInput').value === "786") {
    document.getElementById('loginBox').style.display = 'none';
  }
}
</script>

</body>
</html>
